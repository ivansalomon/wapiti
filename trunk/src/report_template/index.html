<!DOCTYPE html>
<html>
<head>
	<title>Title</title>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" type="text/css" href="css/kube.min.css" />
    <link rel="stylesheet" type="text/css" href="css/master.css" />
    <script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript">
        function fillReport()
        {
          var report_data = __JSON_DATA__ ;
          var details = document.getElementById('details');

          var vuln_count = 0;
          for(var vuln_name in report_data['classifications'])
          {
            console.log(vuln_name);
            var vuln_infos = report_data['classifications'][vuln_name];
            var vuln_desc = vuln_infos['desc'];
            var vuln_solution = vuln_infos['sol'];
            var vuln_refs = vuln_infos['ref'];

            // Add vuln type header
            var h2 = document.createElement('h2');
            h2.innerHTML = vuln_name;
            details.appendChild(h2);

            // Add vuln type definition
            var dl = document.createElement('dl');
            var dt = document.createElement('dt');
            dt.innerHTML = "Description";
            var dd = document.createElement('dd');
            dd.innerHTML = vuln_desc;
            dl.appendChild(dt);
            dl.appendChild(dd);
            details.appendChild(dl);

            // Add vulnerabilities of this type
            for(var i=0; i<report_data['vulnerabilities'][vuln_name].length; i++)
            {
              var vuln_obj = report_data['vulnerabilities'][vuln_name][i];
              var h3 = document.createElement("h3");
              h3.innerHTML = "Vulnterability found in " + vuln_obj.path;
              details.appendChild(h3);

              var nav = document.createElement("nav");
              nav.setAttribute("class", "nav-tabs");
              nav.setAttribute("data-toggle", "tabs");
              nav.setAttribute("data-height", "equal");

              var tab_ul = document.createElement('ul');
              var tab_li1 = document.createElement('li');
              var tab_link1 =document.createElement('a');
              tab_link1.innerHTML = "Description";
              tab_link1.setAttribute("class", "active");
              tab_link1.setAttribute("href", "#tab" + vuln_count + "-1");
              tab_li1.appendChild(tab_link1);

              var tab_li2 = document.createElement('li');
              var tab_link2 =document.createElement('a');
              tab_link2.innerHTML = "HTTP Request";
              tab_link2.setAttribute("href", "#tab" + vuln_count + "-2");
              tab_li2.appendChild(tab_link2);

              var tab_li3 = document.createElement('li');
              var tab_link3 =document.createElement('a');
              tab_link3.innerHTML = "cURL command line";
              tab_link3.setAttribute("href", "#tab" + vuln_count + "-3");
              tab_li3.appendChild(tab_link3);

              tab_ul.appendChild(tab_li1);
              tab_ul.appendChild(tab_li2);
              tab_ul.appendChild(tab_li3);

              nav.appendChild(tab_ul);
              details.appendChild(nav);

              // Description div
              var div1 = document.createElement("div");
              div1.setAttribute("id", "tab" + vuln_count + "-1");
              var desc_pre = document.createElement('pre');
              desc_pre.innerHTML = vuln_obj.info;
              div1.appendChild(desc_pre);

              // HTTP Request div
              var div2 = document.createElement("div");
              div2.setAttribute("id", "tab" + vuln_count + "-2");
              var http_pre = document.createElement('pre');
              http_pre.innerHTML = vuln_obj.http_request;
              div2.appendChild(http_pre);

              // cURL cmd div
              var div3 = document.createElement("div");
              div3.setAttribute("id", "tab" + vuln_count + "-3");
              var curl_pre = document.createElement('pre');
              curl_pre.innerHTML = vuln_obj.curl_command;
              div3.appendChild(curl_pre);

              details.appendChild(div1);
              details.appendChild(div2);
              details.appendChild(div3);
              vuln_count++;
            }

            // Add vuln type solution
            var dl_solution = document.createElement('dl');
            var dt_solution = document.createElement('dt');
            dt_solution.innerHTML = "Solutions";
            var dd_solution = document.createElement('dd');
            dd_solution.innerHTML = vuln_solution;
            dl_solution.appendChild(dt_solution);
            dl_solution.appendChild(dd_solution);
            details.appendChild(dl_solution);


            // Add vuln type references
            var h5 = document.createElement('h5');
            h5.innerHTML = "References";
            details.appendChild(h5);
            var ul = document.createElement('ul');
            for(var ref_desc in vuln_refs)
            {
              var li = document.createElement('li');
              var ref_link = document.createElement("a");
              ref_link.innerHTML = ref_desc;
              ref_link.setAttribute("href", vuln_refs[ref_desc]);
              li.appendChild(ref_link);
              details.appendChild(li);
            }
            details.appendChild(document.createElement('br'));
            details.appendChild(document.createElement('hr'));

          }

          kube_tabs_js = document.createElement('script');
          kube_tabs_js.setAttribute("type", "text/javascript");
          kube_tabs_js.setAttribute("src", "js/kube.tabs.js");
          document.getElementsByTagName('head')[0].appendChild(kube_tabs_js);
        }
    </script>
	<!--[if lt IE 9]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

</head>
<body onload="fillReport()">
    <div id="page">
        <header id="header">
          <h1>Wapiti report</h1>
          <h1 class="subheader">for TO_CHANGE</h1>
        </header>
        <hr />
        <h2>Sumary</h3>
        <table class="width-100 hovered">
            <thead>
                <tr>
                    <th>category</th>
                    <th>level</th>
                    <th>count</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>cat1</td>
                    <td>...</td>
                    <td>...</td>
                </tr>
                <tr>
                    <td>cat2</td>
                    <td>...</td>
                    <td>...</td>
                </tr>
                <tr>
                    <td>cat3</td>
                    <td>...</td>
                    <td>...</td>
                </tr>
            </tbody>
        </table>
        <hr />
        <div id="details">
        </div>
	</div>
</body>
</html>
